
# HACK IT AWAY

At the moment there is an issue with the composer that prevents the full workflow to work correctly.  
You can try a scaled down version of it based on RHEL 8.7+.

Start by installing RHEL 8.7+ on the **MS** and run the setup image builder [script](scripts/configure-builder).

Configure local Microshift repo with the following [script](scripts/mirror-repos).  

For the building process you can use the 2 blueprints provided in the [blueprint](blueprints/) folder:  
- the [blueprint](blueprints/blueprint_first_step.toml) needs to be pushed and built as the first one and it includes Microshift and other troubleshooting packages  
- the [blueprint](blueprints/blueprint_second_step.toml) will produce an ISO, usable on **Edge Device**.

To perform the first build you can run:

`sudo composer-cli compose start-ostree <BLUEPRINT_NAME> edge-container`

Download the generated container (TAR file): 

`sudo composer-cli compose image <uuid>`

Change the owner with:  

`sudo chown $(whoami) <IMAGE_TAR_FILE>`  

Load and run the container with Podman:  

`sudo podman load -i UUID-container.tar`

Tag the new RHEL for Edge Container image, using the image ID generated by the previous step:  

`sudo podman tag image-ID localhost/edge-container`

Run the container named edge-container and expose it on port 8080 (make sure the firewall is open on that port on the *Image Builder*):  

`sudo podman run -d --name=edge-container -p 8090:8080 localhost/edge-container`

Build the final installer image with:  

`sudo composer-cli compose start-ostree <BLUEPRINT_INSTALLER_NAME> edge-simplified-installer --ref rhel/${baserelease}/${basearch}/edge --url http://<IMAGE_BUILDER_IP>:<IMAGE_PUBLISH_PORT>/repo/`

Find the ID of the generate image with:  

`sudo watch composer-cli compose status`

Then, download the ISO file from the Image Builder using the ID and change the owner if you are not using the root user:
```
sudo composer-cli compose image <ISO_IMAGE_ID>
sudo chown $(whoami) <FDO_ISO_IMAGE_ID>-simplified-installer.iso
```

At this point you should have an ISO file (downloaded in the Image Builder) that you can use to deploy the **Edge Device**.  